---
title: "Methods"
author: "Ernesto Ramirez"
date: "January 27, 2016"
output:
  github_document:
    toc: true
    toc_depth: 3
    html_preview: false
  pdf_document:
    toc: yes
  html_document:
    toc: true
    toc_float: true
  word_document:
csl: apa-no-ampersand.csl
bibliography: library.bib
---
# Methods
## Research Design.

This study was designed to elicit both qualitative and quantitative information from individuals who had been using a physical activity tracking device (Fitbit) for long period of time (>= 90 days). Participants recruited to participate in this research study were asked to complete two phases in order to participate in the study. In the initial phase participants who met the inclusion criteria and consented to be included in the study were asked to connect their Fitbit accounts to the Fitabase analytics system (Small Steps Labs, San Diego, CA, USA). This allowed participants to grant access to their historical data, collected through their Fitbit device, to the investigator. Once participants completed phase one they were asked to take part in a two-stage interview in-person, via phone, or via a web-video conference. Each interview was designed to last between 1.5 and 2 hours. The first stage of the interview consisted of gathering demographic data and completing various psychosocial measures. This lasted approximately 30 minutes. The second stage of the interview was a semi-structured interview and conversation with the pariticpant that covered a variety of topics related to the participants’ use of the Fitbit, the participants’ relationship with the data it collects, and the use of behavior change techniques. The institutional review board from the Univeristy of California, San Diego approved this study.

### Setting

As participants were able to complete both phases of the study remotely, this study was open to individuals living in the United States and abroad.

### Recruitment

Participants were recruited through a variety of web and personal channels. Recruitment materials (see appendix TK) that described the study were posted to the following locations:

-   Fitbit subreddit (available at <http://reddit.com/r/fitbit>)
-   Fitbit discussion forums (available at <https://community.fitbit.com/t5/Discussions/ct-p/discussions>)
-   Quantifiedself.com forums (available at <https://forum.quantifiedself.com>)
-   Quantified Self Facebook group (available at <https://www.facebook.com/groups/quantifiedself/>)

These online groups and websites are open to anyone and are used to announce events and opportunities, engage in open discussion, and coordinate group activities. The primary investigator posted under his own account or under an account labeled, "UCSDFitbitStudy". Snowball sampling was also used to recruit additional participants. At the conclusion of the interview participants were asked to recommend study participation to individuals who are listed in their “Fitbit Friends” network and additional friends or family who meet the inclusion criteria. Additional copies of of the recruitment materials were provided to participants who expressed interest in sharing the study with others. All recruitment materials prompted individuals to contact the primary investigator via email (<erramirez@ucsd.edu>) if they were interested in participating. The primary investigator replied to all individuals who expressed interest with additional information about the study and a prompt to schedule a brief (10 to 15 minute) screening phone call. If the individual met the inclusion and exclusion criteria (described below) they were provided a copy of the informed consent and the study methods were described in detail. If the individual consented to be a participant in the study they were prompted to schedule an interview with the primary investigator and were given detailed instructions on how to connect their Fitbit account to the Fitabase analytics system.

### Inclusion and Exclusion Criteria

Inclusion and exclusion criteria consisted of: 1) men and women between 18 and 60 years old, 2) current user of a Fitbit activity tracking device, 3) a minumum of 90 days of use of any combination of Fibit activity tracking devices, 4) the ability to use video teleconferencing systems (e.g. Skype, Google Hangout, Facetime), 5) willing and able authorize the primary investigator to access and download a copy of Fitbit data via the Fitabase analytics system, 6) no more than six (20% of total sample size) particiapnts who identify as early adopters of self-tracking practices as derived from their membership in Quantified Self meetup groups or online communities. Participants were not excluded based on ethnic background, location, or health status.

## Primary and Secondary Outcome Measures

### Fitbit Data Collection
In addition to the user-centered components of the Fitbit system (device, application, and dashboard), Fitbit has developed and provides access to an application programming interface (API) so that outside entities can build tools and services to enhance the user experience. The API allows a third party to access and add to the data currently gathered and stored in the Fitbit database. These read/write privileges allow an application developer to build visualizations, reminder tools, and add additional services to existing behavioral or data storage platforms.

In order to access Fitbit data from research participants, the Fitabase service was used. Fitabase provides a simple platform for authenticating participants and accessing the data gathered while using a Fitbit device. Fitabase has been chosen because all data is stored in a secure server, and its history of collaboration with research institutions [@Cadmus-Bertram2015; Choi2015; @Diaz2015a; @Hartman2015; @Schaefer2016]. Participants were be asked to authorize the Fitabase system to access their Fitbit data and make it available for download for analysis. All participants authorized the Fitabase system via an online portal.

Online Authorization. The participant was asked for a valid email address to send the authorization link. The author then created a profile for the participant that included their assigned unique study identifier. A link to Fitabase Authorization Page was then emailed to the participant. The online Fitabase Authorization Page contains the same text as the Fitabase Authorization page (Appendix TK). At the bottom of the online Fitabase Authorization page a “connect your device” button was presented. The participant was asked to read the authorization page and if they agreed, to connect their Fitbit and authorize Fitabase to read and access their Fitbti data. It important to note that the personal login information for each particiapnt was be entered outside of the view of the author and is not passed to the Fitabase system (it uses the OAuth protocol established for API authentication). When the participant entered their information and connected their Fitbit account to Fitabase the online authorization was completed. This completion also signaled an acceptance of the Fitabase Terms of Use and Privacy Policy [@Fitabase2016].

### Fitbit Data
For each participant, data at the interday (daily aggregate values) level, and at the intraday (minute-by-minute values) level was available for downloading and analysis. At the interday level the following data was downloaed: Steps, Distance Traveled, Very Active Minutes, Fairly Active Minutes, Lightly Active Minutes, Sedendaty Minutes, and Estimated Energy Expenditure. At the intraday level, the following data is avaialble and was downloaded: Steps, Intensity Classifcation, MET Values, and Estimated Energy Expenditure. All Fitabase data files were downloaded in CSV format. The current study did not examinine sleep, weight, or dietary data. If that data was present for a participant via the Fitabase interface it was not viewed, downloaded, or saved as part of the research protocol. All participant data files were checked for completeness. In rare cases a participant's daily and/or intraday data files were missing data. In these cases the primary investigator requested that Fitabase re-run the data request from Fitbit in order to generate complete data files.

### Fitbit Data Processing
_Usage_.
There was a wide range for the length of time participants had been using a Fitbit device. To simplify understanding the the term, "Fitbit user period" is used to describe the total length of time a participant has been in identified as a user with the Fitbit ecosystem, from the date of the creation of a Fitbit use account until the date of their interview. It is possible that the Fitbit user period does not accurately reflect the total time a participant was using a Fitbit device. As this data is retrospective in nature there is not guarantee that the participants were using their device and collecting physical activity information for each of the days present in their data files. Participants may have lost a device for a period of time, forgotten to wear their device, or even chosen not to wear it for a particular day or period of time. Even if the device is not worn, and it does not move, the data is still synced to Fitbit and made available through the API. Typically this results in a day with values equal to zero for physical activity data (steps, active minutes, distance, etc.). These days are included when the historical data is accessed. This complete historical file was used in order to calculate the Fitbit user period. Participants in this study ranged from relatively new to using a Fitbit device to long-term users, with a range of 98 to 2,014 days. On average, participants in the current study had mean user period of 688 days (SD = 487.54). The initial review of all historical Fitbit data from the 30 participants in this study resulted in a total of 20,637 participant-days of available Fitbit data. To better classify the available data, and use data that most accurately reflected actual device wear a multi-step wear time classification process was conducted.

_Wear Time Processing_.
The first step for determining valid wear days was to detect and remove all days with zero steps. This initial pass reduced the full data set from 20,637 to 17,232 person-days.

The second step involved a typical weartime validation process commonly used when processing physical activity accelerometer data. Initially, minute-level step values were used to approximate the commonly used count measure produced by research accelerometers such as the ActiGraph GT3X. However, since accelerometer counts are derived from the intensity of the accelerometer movement in Actigraph models [@ActigraphCount], additional data sources provided by Fitbit were explored. Fitbit states:

>All Fitbit trackers calculate active minutes using metabolic equivalents (METs). METs help measure the energy >expenditure of various activities. Because they do so in a comparable way among persons of different weights, METs are >widely used as indicators for exercise intensity. For example, a MET of 1 indicates a body at rest. Fitbit trackers >estimate your MET value in any given minute by calculating the intensity of your activity. [@FitbitMET]

Since the minute-level MET value provided by Fitbit is a more appropriate measure for inferring the movement of the actual device, and not a behavioral measure, like steps, this was used for wear time analysis.

Minute-Level data files containing the date/time stamps and MET values were downloaded from Fitabase for each participant. The data was processed in R and the "accelerometry" package was used to analyze and flag period of non-wear time [@rstats; @accelerometry]. The data was processed using parameters commonly used for processing accelerometer data in physical activity research [@Troiano2008; @Choi2011]. These parameters include a minimum non-wear window of 90 minutes, a tolerance of two minutes for non-zero counts within a non-wear window, a maximal tolerance of two METs for a minute within the non-wear window. Additionally, processing was set to use a moving window to go through every possible 90-minute window in the data. Days were classified as valid if at least 600 minutes was classified as valid wear time within a 24hr day period using this processing method. Processing the minute-level MET data for each participant for algorithmically determined non-wear time resulted in further reduction to 15,954 valid person-days.

##Visual Analysis
To further inspect the Fitbit data for characteristics that would indicate invalid days a visual analysis of the data was employed. Each participant's minute-level step and MET data were plotted and inspected for uncharacteristic values and patterns. Specifically, this visual analysis of the minute-level data allowed for the identification of periods of data that could be attributed to device malfunctions or non-locomotor activity. Figure [TK] provides an annotated example of data that was identified as inconsistent with normal activity patterns.

##Censuring Abnormal Data
After the visual analysis it was determined that step values greater than or equal to 200 steps per minute should be classified as abnormal. As 200 steps per minute could be possibly achieved by the participants a conservative process was used to eliminate valid days that included abnormal minutes. Days previously marked as valid were censured if greater than ten percent of their daily step total was attributed to abnormal minutes.

After the processing steps described above a total of 15,941 valid participant-days of data were used for analysis. The ratio of valid days to total available days per participant ranged from 10.22% to 99.27%. The number of days of data at each step in the previously described analysis is presented in Table [TK]. A visual representation of all valid wear days is presented in figure [TK]. It was determined that individuals who possesed less that 50% valid days to total available days (Valid Days / Fitbit User Period) would not be included in the statistical analysis as their data represents inconsistent wear behavior and may not be representative of actual physical activity behavior. These individuals' interviews were retained and included in the contextual analysis.


```{r, results = 'asis'}
library(knitr)
library(plyr)
load("~/Dropbox/Dissertation.Data/FitbitData/ProcessedData/Daily.Activity.Final.rdata")
WearTable <- ddply(Daily.Activity.Final, c("id"), summarise, 'Initial Available Days'=length(id),
                   'Valid Days (MET Processing)'=sum(ValidDay.Counts),
                   'Valid Days (Censured)'=sum(ValidDay.Censured),
                   'Valid Days (Final)'=sum(Valid.Final)
                   )
kable(WearTable, caption = "Table [TK]")
```

### Interview
A short set of interview questions was be prepared prior to recruitment and was refined to reflect emerging knowledge as the research process progressed. The interviews were conducted in order to uncover the narratives and processes that reflect the realty of using a physical activity tracker. An Informed Grounded Theory approach was used to transcribe, code, and identify themes from the interviews. This approach is based on the use of prior research and literature to inform and focus attention on specific ideas or concepts during the qualitative research process (Thornberg, 2012). By using prior research, specifically the 93 BCTs in the BCTTv1, as well as findings from similarly designed studies, this process built on existing knowledge while simultaneously being open to the identification of new and unique themes and phenomena related to physical activity tracker use.

### Demographic Information.
Participants completed a demographic questionnaire that included birth year, gender, race/ethnicity, education, height, weight, marital status, and household income.

### 7-Day Physical Activity Recall (PAR)
The 7-Day PAR is a validated, interview-administered, semi-structured physical activity recall survey [@Sallis1985a]. Participants were asked to recall their sleep and physical activity behaviors (and corresponding intensities) for the previous seven days.

### Psychosocial Survey
All participants were asked to complete a psychosocial survey designed to identify various aspects of physical activity behavior and thought processes. These measures, designed and validated for use with adult men and women include short surveys to determine decisional balance, self-efficacy, behavior change strategies, and social support related to physical activity behavior [@Carlson2012].

#

```{r}
library(knitr)
load("~/Dropbox/Dissertation.Data/Data/wear.days.table.rdata")
kable(wear.days.table, caption = "Table [TK]: Valid Wear Time per Participant")
```

```{r, fig.cap = "Valid Days per Participant"}
library(ggplot2)
load("~/Dropbox/Dissertation.Data/FitbitData/ProcessedData/Daily.Activity.Final.rdata")
ggplot(Daily.Activity.Final, aes(x=Date, y=Valid.Final)) +
  geom_bar(stat="identity") +
  scale_y_continuous(breaks=NULL, labels = NULL) +
  facet_grid(id ~.)
```
### Coding Interviews





>Fitabase has provided a document explaining their privacy and security protocols. It is included in this application: Fitbit_SecurityPrivacy.docx

>In order to access Fitbit data from research participants the Fitabase data tool will be used. Fitabase provides a simple platform for authenticating participants and accessing the data they’ve gathered while using a Fitbit device. Fitabase has been chosen because all data is stored in a secure server, it’s history of collaboration with research institutions, and the ability to gather non-activity data associated with a participant’s Fitbit account (see Appendix TK). The data types available from the Fitabase system include:
